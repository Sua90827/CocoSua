<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.suamall.project.repository.ProductRepository">
	
	<select id="checkDB" resultType="com.suamall.project.dto.CategoryDTO">
		SELECT * FROM sh_product_cate WHERE cate_nm=#{cate_nm}
	</select>
	
	<select id="getColorList" resultType="com.suamall.project.dto.ColorDTO">
		SELECT * FROM sh_product_color
	</select>
	<select id="getCategoryList" resultType="com.suamall.project.dto.CategoryDTO">
		SELECT * FROM sh_product_cate
		ORDER BY cate_id ASC
	</select>
	
	<select id="getMaxId" resultType="Integer">
		SELECT nvl(max(prdt_id), 10000)+1
		From sh_product_info
	</select>
	
	<insert id="productInsert" parameterType="com.suamall.project.dto.ProductDTO">
		INSERT INTO sh_product_info VALUES(#{prdt_id}, #{cate_id}, #{prdt_nm}, #{prdt_img}, #{prdt_title}, 
		#{prdt_content}, #{prdt_color}, #{prdt_price}, #{prdt_amount})
	</insert>
	
	<insert id = "cate_id" parameterType = "com.suamall.project.dto.CategoryDTO">
		<selectKey keyProperty="cate_id" resultType="Integer" order="BEFORE">
			SELECT nvl(max(cate_id), 10000)+1
			FROM sh_product_cate
		</selectKey>
		INSERT INTO sh_product_cate VALUES(#{cate_id}, #{cate_nm})
	</insert>
	
	<select id="selectAll" resultType="com.suamall.project.dto.ProductDTO">
		SELECT * FROM SH_PRODUCT_INFO
	</select>
	
	<select id="getProductListView" resultType="com.suamall.project.dto.ProductListViewDTO">
		SELECT a.*, b.cate_nm, c.color_nm FROM sh_product_info a 
		INNER JOIN sh_product_color c ON a.prdt_color=c.color_id 
		INNER JOIN sh_product_cate b ON a.cate_id=b.cate_id
		ORDER BY a.prdt_id DESC
	</select>
	
	<select id="getCateName" resultType="String">
		SELECT cate_nm FROM sh_product_cate WHERE cate_id = #{cate_id}
	</select>
	
	<select id="getPrdtDTO" resultType="com.suamall.project.dto.ProductDTO">
		SELECT * FROM sh_product_info WHERE prdt_id = #{prdt_id}
	</select>
	<update id="updateExceptFile" parameterType="com.suamall.project.dto.ProductDTO">
		UPDATE sh_product_info SET cate_id = #{cate_id}, prdt_nm = #{prdt_nm}, prdt_title = #{prdt_title},
		prdt_content = #{prdt_content}, prdt_color = #{prdt_color}, prdt_price = #{prdt_price}, 
		prdt_amount = #{prdt_amount} WHERE prdt_id = #{prdt_id}
	</update>
	<update id="updateIncludeFile" parameterType="com.suamall.project.dto.ProductDTO">
		UPDATE sh_product_info SET cate_id = #{cate_id}, prdt_nm = #{prdt_nm}, prdt_img = #{prdt_img}, prdt_title = #{prdt_title},
		prdt_content = #{prdt_content}, prdt_color = #{prdt_color}, prdt_price = #{prdt_price}, 
		prdt_amount = #{prdt_amount} WHERE prdt_id = #{prdt_id} 
	</update>
	<select id="getAllByCateId" resultType="com.suamall.project.dto.ProductDTO">
		SELECT * FROM sh_product_info WHERE cate_id = #{cate_id}
	</select>
	<select id="getCateColorNmByPrdtId" resultType="com.suamall.project.dto.ProductListViewDTO">
		SELECT a.*, b.cate_nm, c.color_nm FROM sh_product_info a 
		INNER JOIN sh_product_color c ON a.prdt_color=c.color_id 
		INNER JOIN sh_product_cate b ON a.cate_id=b.cate_id
		WHERE a.prdt_id = #{prdt_id}
	</select>
	<delete id="CateDelete" parameterType="com.suamall.project.dto.CategoryDTO">
		DELETE FROM sh_product_cate WHERE cate_id=#{cate_id}
	</delete>
</mapper>